<?xml version="1.0" encoding="UTF-8" ?>
<beans
          xmlns="http://www.springframework.org/schema/beans"
          xmlns:security="http://www.springframework.org/schema/security"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:mvc="http://www.springframework.org/schema/mvc"
          xmlns:oauth="http://www.springframework.org/schema/security/oauth2"
          xmlns:util="http://www.springframework.org/schema/util"
          xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/security https://www.springframework.org/schema/security/spring-security.xsd
    http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd
    http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd
    http://www.springframework.org/schema/security/oauth2 https://www.springframework.org/schema/security/spring-security-oauth2-2.0.xsd">

    <oauth:resource id="uaa" access-token-uri="${uaa.token.url:http://localhost:8080/uaa/oauth/token}"
                    client-id="login" client-secret="${LOGIN_SECRET:loginsecret}" type="client_credentials"/>

    <bean id="resetPasswordEntryPoint"
                    class="org.cloudfoundry.identity.uaa.account.ResetPasswordAuthenticationEntryPoint"/>
    <bean id="resetPasswordAuthenticationFilter"
                    class="org.cloudfoundry.identity.uaa.account.ResetPasswordAuthenticationFilter">
        <constructor-arg name="entryPoint" ref="resetPasswordEntryPoint"/>
        <constructor-arg name="handler" ref="accountSavingAuthenticationSuccessHandler"/>
        <constructor-arg name="service" ref="resetPasswordService"/>
        <constructor-arg name="expiringCodeStore" ref="codeStore"/>
    </bean>

    <bean id="loginCookieCsrfRepository"
                    class="org.cloudfoundry.identity.uaa.security.web.CookieBasedCsrfTokenRepository">
        <property name="secure" value="${require_https:false}"/>
    </bean>

    <bean id="accountSavingAuthenticationSuccessHandler"
                    class="org.cloudfoundry.identity.uaa.login.AccountSavingAuthenticationSuccessHandler">
        <constructor-arg name="redirectingHandler" ref="successRedirectHandler"/>
        <constructor-arg name="currentUserCookieFactory" ref="currentUserCookieFactory"/>
    </bean>

    <bean id="currentUserCookieFactory" class="org.cloudfoundry.identity.uaa.login.CurrentUserCookieFactory">
        <constructor-arg name="sessionTimeout" value="${servlet.session-cookie.max-age:1800}"/>
        <constructor-arg name="secure" value="${require_https:false}"/>
    </bean>

</beans>
